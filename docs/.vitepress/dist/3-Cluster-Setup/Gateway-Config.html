<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gateway Node Configuration Guide | Kube documentation</title>
    <meta name="description" content="Key details on setting up cluster from scratch.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/dtikube_service/assets/style._Za1h4vX.css" as="style">
    <link rel="preload stylesheet" href="/dtikube_service/vp-icons.css" as="style">
    
    <script type="module" src="/dtikube_service/assets/app.0kUKsp_f.js"></script>
    <link rel="preload" href="/dtikube_service/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/framework.Do9hWntK.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/theme.CDL5D6to.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/katex.BbEIqZs1.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/dagre-6UL2VRFP.3bhapheh.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/cose-bilkent-S5V4N54A.DnRwqOoL.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/c4Diagram-YG6GDRKO.CH_P5kig.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/flowDiagram-NV44I4VS.DTyjyuIT.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/erDiagram-Q2GNP2WA.BiXax77o.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/gitGraphDiagram-NY62KEGX.BE8vZ6Ft.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/ganttDiagram-LVOFAZNH.CDTtpC_Z.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/infoDiagram-ER5ION4S.BTmpCogj.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/pieDiagram-ADFJNKIX.C7oOount.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/quadrantDiagram-AYHSOK5B.D96Zc8KM.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/xychartDiagram-PRI3JC2R.8LxnHeBm.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/requirementDiagram-UZGBJVZJ.C0rsRvO5.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/sequenceDiagram-WL72ISMW.BHdDVv6u.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/classDiagram-2ON5EDUG.BOFBg7FX.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/classDiagram-v2-WZHVMYZB.BOFBg7FX.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/stateDiagram-FKZM4ZOC.Bwcbm3Rq.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/stateDiagram-v2-4FDKWEC3.CZkSMCih.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/journeyDiagram-XKPGCS4Q.BoGnXOxw.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/timeline-definition-IT6M3QCI.6ggpRIiW.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/mindmap-definition-VGOIOE7T.BGkYcQhO.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/kanban-definition-3W4ZIXB7.ClaA0df8.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/sankeyDiagram-TZEHDZUN.Cp3N8KBB.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-S2PKOQOG.MYF1XtDT.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-QEK2KX5R.UU8NSFSn.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/blockDiagram-VD42YOAC.DImL5UMn.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/architectureDiagram-VXUJARFQ.C5vZz6j9.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-PSM6KHXK.C06nF177.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/dtikube_service/assets/3-Cluster-Setup_Gateway-Config.md.0bEJfpDl.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/dtikube_service/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Kube documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/dtikube_service/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Project Overview</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Purpose.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Purpose</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Architecture-Design.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Architecture Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Technology.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Technology Stack</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Access management</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/2-Access-Management/Account-Profiles.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Account Profiles</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Cluster setup</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/3-Cluster-Setup/Gateway-Config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Gateway Config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/3-Cluster-Setup/Node-Config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Node Config</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Automation</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/4-Automation/Ansible-node-setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Ansible Node Setup</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Kubernetes</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/5-Kubernetes/k3s-Setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>k3s Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/5-Kubernetes/Kube-commands.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Kube Commands</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Monitoring</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/7-Monitoring/Metric-server.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Metric Server</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/7-Monitoring/Prometheus-setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Prometheus Guide</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Networking</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/6-Networking/k3s-Networking.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>k3s Networking</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _dtikube_service_3-Cluster-Setup_Gateway-Config" data-v-39a288b8><div><h1 id="frontmatter-title" tabindex="-1">Gateway Node Configuration Guide <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">‚Äã</a></h1><p align="center"><img alt="pikube-logo" src="data:image/svg+xml,%3c?xml%20version=&#39;1.0&#39;%20encoding=&#39;iso-8859-1&#39;?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20version=&#39;1.1&#39;%20id=&#39;Layer_1&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20xmlns:xlink=&#39;http://www.w3.org/1999/xlink&#39;%20viewBox=&#39;0%200%20512%20512&#39;%20xml:space=&#39;preserve&#39;%3e%3crect%20x=&#39;329.808&#39;%20y=&#39;56&#39;%20style=&#39;fill:%23333333;&#39;%20width=&#39;182.192&#39;%20height=&#39;400&#39;/%3e%3crect%20x=&#39;360.8&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23FFFFFF;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;360.8&#39;%20y=&#39;102.08&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;120.528&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;404.96&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23D6D6D6;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;404.96&#39;%20y=&#39;401.12&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;449.12&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23FFFFFF;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20y=&#39;56&#39;%20style=&#39;fill:%23333333;&#39;%20width=&#39;182.192&#39;%20height=&#39;400&#39;/%3e%3crect%20x=&#39;30.992&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23FFFFFF;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;30.992&#39;%20y=&#39;102.08&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;120.528&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;75.152&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23D6D6D6;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;75.152&#39;%20y=&#39;401.12&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3crect%20x=&#39;119.312&#39;%20y=&#39;125.024&#39;%20style=&#39;fill:%23FFFFFF;&#39;%20width=&#39;31.888&#39;%20height=&#39;11.952&#39;/%3e%3cg%3e%3crect%20x=&#39;284.784&#39;%20y=&#39;218.448&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;82.544&#39;%20height=&#39;16&#39;/%3e%3cpolygon%20style=&#39;fill:%230BA4E0;&#39;%20points=&#39;293.408,187.056%20236.864,226.448%20293.408,265.84%20&#39;/%3e%3crect%20x=&#39;144.64&#39;%20y=&#39;324.272&#39;%20style=&#39;fill:%230BA4E0;&#39;%20width=&#39;82.544&#39;%20height=&#39;16&#39;/%3e%3cpolygon%20style=&#39;fill:%230BA4E0;&#39;%20points=&#39;218.592,371.664%20275.136,332.272%20218.592,292.88%20&#39;/%3e%3c/g%3e%3c/svg%3e" width="25%"></p><h2 id="gateway-setup" tabindex="-1">Gateway Setup <a class="header-anchor" href="#gateway-setup" aria-label="Permalink to &quot;Gateway Setup&quot;">‚Äã</a></h2><p>Central component in the architecture, controlling all the traffic, connecting to internet and acting as DNS, DCHP, NTP and firewall server. Cluster is accessed using gateway as a jump server.</p><h3 id="gateway-node" tabindex="-1">Gateway node <a class="header-anchor" href="#gateway-node" aria-label="Permalink to &quot;Gateway node&quot;">‚Äã</a></h3><ul><li><strong><code>berryX</code></strong> : RaspberryPi 4B, 8GB</li></ul><h2 id="os-deployment" tabindex="-1">üíø OS deployment <a class="header-anchor" href="#os-deployment" aria-label="Permalink to &quot;:cd: OS deployment&quot;">‚Äã</a></h2><p>The gateway node runs on the latest Ubuntu 25.10 server. The process for setting up your OS on Raspebbry Pi can be done in following steps.</p><ol><li><p>Download and install microSD Imager: <a href="https://ubuntu.com/download/raspberry-pi" target="_blank" rel="noreferrer">Raspberry Pi Imager</a></p></li><li><p>Flash the MicroSD card with desired OS type and version</p></li><li><p>Update cloud-init config files: <code>user-data</code> and <code>network-config</code></p></li></ol><h2 id="cloud-init-configuration" tabindex="-1">‚öôÔ∏è Cloud-init configuration <a class="header-anchor" href="#cloud-init-configuration" aria-label="Permalink to &quot;:gear: Cloud-init configuration&quot;">‚Äã</a></h2><p>Using standard YAML formatted file for all nodes to setup default access point and network settings.</p><p>Replace all content of <code>user-data</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#cloud-config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># System Configuration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">timezone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Europe/London</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">locale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">en_GB.UTF-8</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">berry01</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">manage_etc_hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># User Account Configuration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">berryadmin</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  primary_group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">users</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  groups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">adm, sudo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  shell</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  lock_passwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ssh_authorized_keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ssh-ed25519 AAAAC3NzaC....TEMPLATE</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #Replace with your public key</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  sudo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ALL=(ALL) NOPASSWD:ALL</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># System Updates</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">package_update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">package_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Essential Packages</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">curl</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">wget</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Inherited security settings</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ssh_pwauth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">disable_root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reboot after configuration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">power_state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">reboot</span></span></code></pre></div><p>Replace all content of <code>network-config</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cloud-init network configuration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">network</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  renderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networkd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ethernets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    eth0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dhcp4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.0.0.1/24</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  wifis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    wlan0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      dhcp4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      optional</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      access-points</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;YourWiFiSSID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;YourWiFiPassword&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;YourWiFiSSID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;YourWiFiPassword&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.1.10/24</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      routes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          via</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168.1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      nameservers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1.1.1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8.8.8.8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8.8.4.4</span></span></code></pre></div><h3 id="after-initial-cloud-init-bootup" tabindex="-1">After initial cloud-init bootup <a class="header-anchor" href="#after-initial-cloud-init-bootup" aria-label="Permalink to &quot;After initial cloud-init bootup&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run package update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> full-upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Network packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dnsmasq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    net-tools</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    haproxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#system packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    git</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    wget</span></span></code></pre></div><h2 id="network-configuration" tabindex="-1">üåê Network configuration <a class="header-anchor" href="#network-configuration" aria-label="Permalink to &quot;:globe_with_meridians: Network configuration&quot;">‚Äã</a></h2><p>The network is segregated in 2 parts</p><ul><li><strong>Home Network Endpoint:</strong> 192.168.1.10/24 Wifi connection to home internet router</li><li><strong>Cluster Network Endpoint:</strong> 10.0.0.1 cable setup into LAN switch</li></ul><h2 id="dns-dhcp-configuration" tabindex="-1">üåê DNS &amp; DHCP configuration <a class="header-anchor" href="#dns-dhcp-configuration" aria-label="Permalink to &quot;:globe_with_meridians: DNS &amp; DHCP configuration&quot;">‚Äã</a></h2><h3 id="dnsmasq-configuration" tabindex="-1">dnsmasq configuration <a class="header-anchor" href="#dnsmasq-configuration" aria-label="Permalink to &quot;dnsmasq configuration&quot;">‚Äã</a></h3><p>dnsmaq is a lightweight DNS, DHCP service that is suitable for smaller network and home lab setup. The setup include Static IP management and DNS forwarding.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. Ensure dnsmasq is installed and enabled</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --installed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnsmasq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnsmasq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#2. Backup default config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/dnsmasq.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/bak_dnsmasq.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#3 Create config location .d if one does not yet exist</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/dnsmasq.d/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#4. Uncomment dnsmasq.conf setting that enables conf file directory lookup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s|#conf-dir=/etc/dnsmasq\.d/,\*\.conf|conf-dir=/etc/dnsmasq.d/,*.conf|&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/dnsmasq.conf</span></span></code></pre></div><h3 id="lan-config-etc-dnsmasq-10-lan-conf" tabindex="-1">LAN config: <code>/etc/dnsmasq./10-lan.conf</code> <a class="header-anchor" href="#lan-config-etc-dnsmasq-10-lan-conf" aria-label="Permalink to &quot;LAN config: `/etc/dnsmasq./10-lan.conf`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -----------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DNSMASQ CONFIG FOR LAN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -----------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Listen only on LAN interface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">eth0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  # DNS and DCHP listening interface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">except-interface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lo</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                             # exclude local loopback</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind-interfaces</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                 # ownership of port 53, avoidance of conflict with other DNS resolvers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DNS security settings</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">no-resolv</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                       # ignore /etc/resolv.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bogus-priv</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                      # blocks reverse lookup responses for private IP range</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop-dns-rebind</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                 # prevents DNS rebind attacks</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rebind-localhost-ok</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                             # allow localhost rebinding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DNS performance settings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cache-size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">500</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  # recommended for small networks 500-2k</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DHCP range on LAN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.0.0.20,10.0.0.200,24h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             #</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DHCP options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-option</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">option:router,10.0.0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # router gateway (3)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-option</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">option:dns-server,10.0.0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # DNS server (6)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-option</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">option:ntp-server,10.0.0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # NTP server (42)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Local DNS domain configuration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dtikube.techinsights.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dtikube.techinsights.com/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expand-hosts</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                    # automatically append domain= to entries from hosts files. /etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Enable DNS and DCHP logging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log-queries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">extra</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               # Log DNS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log-dhcp</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        # Log DHCP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#DNS external servers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1.1.1.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  # Cloudflare primary</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8.8.8.8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  # Google primary</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">8.8.4.4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  # Google secondary</span></span></code></pre></div><h3 id="static-config-etc-dnsmasq-10-lan-conf" tabindex="-1">Static config: <code>/etc/dnsmasq./10-lan.conf</code> <a class="header-anchor" href="#static-config-etc-dnsmasq-10-lan-conf" aria-label="Permalink to &quot;Static config: `/etc/dnsmasq./10-lan.conf`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -----------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DNSMASQ CONFIG FOR Static IP assignments</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -----------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Resered satic IP addresses for master nodes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d8:3a:dd:e2:85:37,berry01,10.0.0.5,infinite</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #1st</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d8:3a:dd:ef:cd:e5,berry02,10.0.0.6,infinite</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #2nd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Reserver static IP address for worker nodes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d8:3a:dd:e2:81:5c,berryw11,10.0.0.11,infinite</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #3rd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dhcp-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">88:a2:9e:29:a0:bb,berryw10,10.0.0.10,infinite</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          #5th</span></span></code></pre></div><h3 id="config-post-checks" tabindex="-1">Config post-checks <a class="header-anchor" href="#config-post-checks" aria-label="Permalink to &quot;Config post-checks&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#1. Restart the service to apply the new settings</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnsmasq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#2. Verify the new setup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dnsmasq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#3. Test DNS resolution, avoid false positive and force lookup through dnsmasq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nslookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> google.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># To make the node pickup new static assigned IP address</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ssh to the node and restart the service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-networkd</span></span></code></pre></div><h2 id="router-configuration" tabindex="-1">Router Configuration <a class="header-anchor" href="#router-configuration" aria-label="Permalink to &quot;Router Configuration&quot;">‚Äã</a></h2><p>LAN cluster by default cannot reach internet outside its local network area. To enable it gateway is configured to act as a router.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable packet forwarding</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;net.ipv4.ip_forward=1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apply forwarding changes now</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Verify setup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/sys/net/ipv4/ip_forward</span></span></code></pre></div><p>With forwarding enabled, the traffic might still not reach intended destination. Lets look at firewall setup to ensure that router setup is working.</p><h2 id="firewall-configuration" tabindex="-1">üî• Firewall Configuration <a class="header-anchor" href="#firewall-configuration" aria-label="Permalink to &quot;:fire: Firewall Configuration&quot;">‚Äã</a></h2><p>To configure our firewall settings <code>nftables</code> will be used as it is more modern and the successor for iptables config. All rules in theory can be defined in <code>/etc/nftables.conf</code> for a small and relatively static network setup.</p><h3 id="check-existing-setup" tabindex="-1">Check Existing Setup <a class="header-anchor" href="#check-existing-setup" aria-label="Permalink to &quot;Check Existing Setup&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check nftables is installed. Use &quot;enable&quot; and &quot;start&quot; if not active.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --installed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nftables</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nftables</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check existing config of nftables</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable nftables start up post server restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nftables</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>Configuration references are key sensitive, for simplicity of setup suggestion is to keep it either all CAPS or all lower case.</p></div><p>The chosen setup features the professional approach of modular structure for nftables configuration, often used in production environments and has improved maintainability and scalability. In addition, the configuration files are numbered to guarantee loading order and provide predictability.</p><h3 id="creating-modular-structure" tabindex="-1">Creating Modular Structure <a class="header-anchor" href="#creating-modular-structure" aria-label="Permalink to &quot;Creating Modular Structure&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create main structure</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/60-nat/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Creating main filtering rulesets and static</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/10-constants.nft</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/20-sets.nft</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/30-input.nft</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/40-forward.nft</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/50-output.nft</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Creating NAT rulesets</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/60-nat/10-prerouting.nft</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.d/60-nat/20-postrouting.nft</span></span></code></pre></div><h3 id="update-etc-nftables-conf" tabindex="-1">Update <code>/etc/nftables.conf</code> <a class="header-anchor" href="#update-etc-nftables-conf" aria-label="Permalink to &quot;Update `/etc/nftables.conf`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/usr/sbin/nft -f</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># General Firewall settings</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This config file is updated only once during initial creation</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Clear ruleset before applying new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flush</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ruleset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># include all modular files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/etc/nftables.d/*.nft&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/etc/nftables.d/nat/*.nft&quot;</span></span></code></pre></div><h3 id="create-constants-set-etc-nftables-d-10-constants-nft" tabindex="-1">Create Constants Set <code>/etc/nftables.d/10-constants.nft</code> <a class="header-anchor" href="#create-constants-set-etc-nftables-d-10-constants-nft" aria-label="Permalink to &quot;Create Constants Set `/etc/nftables.d/10-constants.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Network Interface Definitions</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lan_if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # LAN network, listening local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wan_if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wlan0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # Home network, listening external</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Network Address Ranges</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lan_net</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.0/24</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # LAN local network</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> home_net</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 192.168.1.0/24</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Home network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incomming_udp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    53,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # DNS service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    123,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # NTP time service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    67,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # DHCP server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    68</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  # DHCP client replies</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incomming_tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    22,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # SSH</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    80,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # HTTP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    443,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # HTTPS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    6443</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # Kubernetes API server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="incoming-traffic-rules-etc-nftables-d-30-input-nft" tabindex="-1">Incoming Traffic Rules <code>/etc/nftables.d/30-input.nft</code> <a class="header-anchor" href="#incoming-traffic-rules-etc-nftables-d-30-input-nft" aria-label="Permalink to &quot;Incoming Traffic Rules `/etc/nftables.d/30-input.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for incoming traffic</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for incomming traffic</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> input</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # default drop all that does not match our ruleset</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> input</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> drop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow loopback interface for local services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lo&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow already established connections</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> established,related</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow LAN access</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> saddr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow incoming UDP services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">udp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $incomming_udp </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow incoming TCP services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $incomming_tcp </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow SSH from trusted hosts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> saddr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.111</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 5. Optional: allow ping from LAN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        icmp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo-request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="create-constants-set-etc-nftables-d-40-forward-nft" tabindex="-1">Create Constants Set <code>/etc/nftables.d/40-forward.nft</code> <a class="header-anchor" href="#create-constants-set-etc-nftables-d-40-forward-nft" aria-label="Permalink to &quot;Create Constants Set `/etc/nftables.d/40-forward.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for packets passing through the router</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # default drop all that does not match our ruleset</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> drop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Allow loopback interface for local services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> established,related</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Enable LAN ‚Üí WAN access to internet services</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">oif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $wan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Enable Wan -&gt; LAN access</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        iif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $wan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">oif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">accept</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Logging with custom string to help with high level analysis and limiting log input to not flood the logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;[GATEWAY FORWARD DROP]: &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5/minute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> burst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packets</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="outgoing-traffic-rules-etc-nftables-d-50-output-nft" tabindex="-1">Outgoing traffic Rules <code>/etc/nftables.d/50-output.nft</code> <a class="header-anchor" href="#outgoing-traffic-rules-etc-nftables-d-50-output-nft" aria-label="Permalink to &quot;Outgoing traffic Rules `/etc/nftables.d/50-output.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for filtering outgoing traffic</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Required to initiate package and system updates and communicate with external services</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Configuration does not restrict outgoing traffic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        policy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="create-dnat-ruleset-etc-nftables-d-60-nat-10-prerouting-nft" tabindex="-1">Create DNAT Ruleset <code>/etc/nftables.d/60-nat/10-prerouting.nft</code> <a class="header-anchor" href="#create-dnat-ruleset-etc-nftables-d-60-nat-10-prerouting-nft" aria-label="Permalink to &quot;Create DNAT Ruleset `/etc/nftables.d/60-nat/10-prerouting.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for DNAT (destination network address translation) and port forwarding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prerouting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prerouting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Logging with custom string to help with high level analysis and limiting log input to not flood the logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;[NAT PREROUTING]: &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5/minute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> burst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Example: port forwarding of external port 80 to internal destination</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># iifname $wan_if tcp dport 80 dnat 10.0.0.5.80</span></span></code></pre></div><h3 id="create-snat-ruleset-etc-nftables-d-60-nat-20-postrouting-nft" tabindex="-1">Create SNAT Ruleset <code>/etc/nftables.d/60-nat/20-postrouting.nft</code> <a class="header-anchor" href="#create-snat-ruleset-etc-nftables-d-60-nat-20-postrouting-nft" aria-label="Permalink to &quot;Create SNAT Ruleset `/etc/nftables.d/60-nat/20-postrouting.nft`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ruleset for SNAT (source network address translation)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Important enabler for LAN cluster access to internet</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    chain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postrouting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> postrouting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Transform (masquarade) intnerl IPs 10.0.0.x into gteway external 192.168.1.x</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        oif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $wan_if </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> saddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $lan_net </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">masquerade</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Logging with custom string to help with high level analysis and limiting log input to not flood the logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;[NAT POSTROUTING]: &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5/minute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> burst</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="post-checks" tabindex="-1">Post Checks <a class="header-anchor" href="#post-checks" aria-label="Permalink to &quot;Post Checks&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check syntax, useful check after config file edit(s)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected output: nothing, unless syntax issue it will throw error details</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nft</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nftables.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List all nftables ruleset </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note that all constants will be replaced with actual values</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nft</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ruleset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List NAT ruleset</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nft</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> table</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Network traffic check from LAN node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #Home internet router IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8.8.8.8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # External IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># check if specific ports are open. Example: ftp, SSH, domain, http, https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 21,22,53,80,443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#check all ports in range 1-1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nmap</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1-1000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.0.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check firewall logs</span></span></code></pre></div><h2 id="ntp-nts-configuration" tabindex="-1">üïí NTP/NTS Configuration <a class="header-anchor" href="#ntp-nts-configuration" aria-label="Permalink to &quot;:clock3: NTP/NTS Configuration&quot;">‚Äã</a></h2><p>Gateway server is positioned to provide Network Time Protocol services using <code>chrony</code>, allowing seamless time accuracy across the cluster.</p><div class="info custom-block"><p class="custom-block-title">Why <strong><code>chrony</code></strong>?</p><ul><li>Moder, fast and high accuracy NTP service</li><li>Can safely handle large de-sync gaps</li><li>Included as default on many newer version Linux distros, replacement of older version <code>ntpd</code></li><li>Is recommended for orchestrated environment like Kubernetes</li><li>Very low CPU and network resource consumption</li></ul></div><h3 id="check-existing-setup-1" tabindex="-1">Check Existing Setup <a class="header-anchor" href="#check-existing-setup-1" aria-label="Permalink to &quot;Check Existing Setup&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check chrony is installed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --installed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chrony</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check current setup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/chrony/chrony.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check current status, Use enable and start to activate.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chrony</span></span></code></pre></div><h3 id="create-server-structure" tabindex="-1">Create Server Structure <a class="header-anchor" href="#create-server-structure" aria-label="Permalink to &quot;Create Server Structure&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create config file for server side</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/chrony/conf.d/ntp-server.conf</span></span></code></pre></div><h3 id="server-configuration-etc-chrony-conf-d-ntp-server-conf" tabindex="-1">Server Configuration <code>/etc/chrony/conf.d/ntp-server.conf</code> <a class="header-anchor" href="#server-configuration-etc-chrony-conf-d-ntp-server-conf" aria-label="Permalink to &quot;Server Configuration `/etc/chrony/conf.d/ntp-server.conf`&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Allow LAN clients to use this router as NTP server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.0/24</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let router serve time even if internet goes down</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stratum 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Optional: Let LAN clients run readonly chronyc commands</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmdallow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.0/24</span></span></code></pre></div><h3 id="server-source-configuration-etc-chrony-sources-d-ubuntu-ntp-pools-sources" tabindex="-1">Server Source Configuration <code>/etc/chrony/sources.d/ubuntu-ntp-pools.sources</code> <a class="header-anchor" href="#server-source-configuration-etc-chrony-sources-d-ubuntu-ntp-pools-sources" aria-label="Permalink to &quot;Server Source Configuration `/etc/chrony/sources.d/ubuntu-ntp-pools.sources`&quot;">‚Äã</a></h3><p>Remains unchanged from original installed configuration version.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Use NTS by default</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NTS uses an additional port to negotiate security: 4460/tcp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The normal NTP port remains in use: 123/udp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1.ntp.ubuntu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iburst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maxsources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2.ntp.ubuntu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iburst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maxsources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3.ntp.ubuntu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iburst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maxsources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.ntp.ubuntu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iburst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maxsources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prefer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The bootstrap server is needed by systems without a hardware clock, or a very</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># large initial clock offset. The specified certificate set is defined in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /etc/chrony/conf.d/ubuntu-nts.conf.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ntp-bootstrap.ubuntu.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iburst</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maxsources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre></div><h3 id="test-ntp-nts-setup" tabindex="-1">Test NTP/NTS Setup <a class="header-anchor" href="#test-ntp-nts-setup" aria-label="Permalink to &quot;Test NTP/NTS Setup&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Restart chrony to load the new config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chrony</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check connection details</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chronyc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sources</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Look for an output starting with ^* (source we are using)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># View chrony activity</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chronyc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> activity</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check NTP clients connected to our server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chronyc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clients</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#should see IP addresses from our local LAN</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/dtikube_service/2-Access-Management/Account-Profiles.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Account Profiles</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/dtikube_service/3-Cluster-Setup/Node-Config.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Node Config</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"00-sample_sample.md\":\"Q6MvTj0A\",\"1-project-overview_architecture-design.md\":\"CQ0RO56J\",\"1-project-overview_purpose.md\":\"ChTBXNes\",\"1-project-overview_technology.md\":\"BoF2LkjD\",\"2-access-management_account-profiles.md\":\"Cl9woTDs\",\"2-access-management_setup-and-hardening.md\":\"C5CRLPlw\",\"3-cluster-setup_control-node-config.md\":\"D12T0pf2\",\"3-cluster-setup_gateway-config.md\":\"0bEJfpDl\",\"3-cluster-setup_node-config.md\":\"DuMkt3oG\",\"4-automation_ansible-node-setup.md\":\"aplv778r\",\"4-automation_ansible-play.md\":\"3v8QYx7j\",\"5-kubernetes_k3s-setup.md\":\"DoN-q9Qc\",\"5-kubernetes_kube-commands.md\":\"BPWYkiJ_\",\"6-networking_extra study.md\":\"CaWqeb-6\",\"6-networking_k3s-networking.md\":\"CjMNEMgp\",\"7-monitoring_metric-server.md\":\"DH7JLClD\",\"7-monitoring_prometheus-setup.md\":\"BrazHxOO\",\"index.md\":\"K6D8Ii3Q\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Kube documentation\",\"description\":\"Documentation for the Baremetal kubernetes setup\",\"base\":\"/dtikube_service/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"}],\"sidebar\":[{\"text\":\"Project Overview\",\"collapsed\":true,\"items\":[{\"text\":\"Purpose\",\"link\":\"/1-Project-Overview/Purpose\"},{\"text\":\"Architecture Setup\",\"link\":\"/1-Project-Overview/Architecture-Design\"},{\"text\":\"Technology Stack\",\"link\":\"/1-Project-Overview/Technology\"}]},{\"text\":\"Access management\",\"collapsed\":true,\"items\":[{\"text\":\"Account Profiles\",\"link\":\"/2-Access-Management/Account-Profiles\"}]},{\"text\":\"Cluster setup\",\"collapsed\":true,\"items\":[{\"text\":\"Gateway Config\",\"link\":\"/3-Cluster-Setup/Gateway-Config\"},{\"text\":\"Node Config\",\"link\":\"/3-Cluster-Setup/Node-Config\"}]},{\"text\":\"Automation\",\"collapsed\":false,\"items\":[{\"text\":\"Ansible Node Setup\",\"link\":\"/4-Automation/Ansible-node-setup\"}]},{\"text\":\"Kubernetes\",\"collapsed\":true,\"items\":[{\"text\":\"k3s Setup\",\"link\":\"/5-Kubernetes/k3s-Setup\"},{\"text\":\"Kube Commands\",\"link\":\"/5-Kubernetes/Kube-commands\"}]},{\"text\":\"Monitoring\",\"collapsed\":true,\"items\":[{\"text\":\"Metric Server\",\"link\":\"/7-Monitoring/Metric-server\"},{\"text\":\"Prometheus Guide\",\"link\":\"/7-Monitoring/Prometheus-setup\"}]},{\"text\":\"Networking\",\"collapsed\":true,\"items\":[{\"text\":\"k3s Networking\",\"link\":\"/6-Networking/k3s-Networking\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>