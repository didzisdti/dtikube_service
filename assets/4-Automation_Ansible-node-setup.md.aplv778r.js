import{_ as n}from"./chunks/ansible.CWkOF6wH.js";import{_ as e}from"./chunks/under-construction.CuWjDGLh.js";import{_ as t,c as l,o as p,j as i,a0 as h,a as k,t as r}from"./chunks/framework.Do9hWntK.js";const B=JSON.parse('{"title":"Ansible Node Setup","description":"Setup details","frontmatter":{"title":"Ansible Node Setup","description":"Setup details"},"headers":[],"relativePath":"4-Automation/Ansible-node-setup.md","filePath":"4-Automation/Ansible-node-setup.md"}'),o={name:"4-Automation/Ansible-node-setup.md"},d={id:"frontmatter-title",tabindex:"-1"};function c(a,s,F,g,y,u){return p(),l("div",null,[i("h1",d,[k(r(a.$frontmatter.title)+" ",1),s[0]||(s[0]=i("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }}"'},"â€‹",-1))]),s[1]||(s[1]=h('<p align="center"><img alt="pikube-logo" src="'+n+`" width="25%"></p><p>Ansible provides open-source automation that reduces complexity and allows automation for the cluster node setup. It is agentless automation tool that you install on a single host called the Control node.</p><div class="info custom-block"><p class="custom-block-title">Why should we use Ansible?</p><ul><li><p><strong>Agent-less architecture:</strong> No additional install maintenance across IT infrastructure.</p></li><li><p><strong>Simplicity:</strong> Easy to read .yaml, decentralized using SSH to access nodes.</p></li><li><p><strong>Scalability and flexibility:</strong> Modular design and wide range of supported platforms.</p></li></ul></div><h2 id="control-node-choice" tabindex="-1">ğŸ‘ï¸ Control node choice <a class="header-anchor" href="#control-node-choice" aria-label="Permalink to &quot;:eye: Control node choice&quot;">â€‹</a></h2><p>Ansible offers several options for setting up the control node</p><ul><li><p>Linux environment options include any Linux machine with supported Linux OS on it.</p></li><li><p>Windows environment with Windows Subsystem for Linux (WSL)</p></li></ul><p>WSL is already chosen for other activities, the Ansible will also reside on WSL and will utilise Execution Environment (EE).</p><h2 id="ansible-setup-guide" tabindex="-1">ğŸ“ Ansible Setup Guide <a class="header-anchor" href="#ansible-setup-guide" aria-label="Permalink to &quot;:memo: Ansible Setup Guide&quot;">â€‹</a></h2><p>For executing our first ansible playbook we will start with the basics of the setup</p><h3 id="setup-pre-requisites" tabindex="-1">Setup Pre-requisites <a class="header-anchor" href="#setup-pre-requisites" aria-label="Permalink to &quot;Setup Pre-requisites&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install pre-requisite packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ansible</span></span></code></pre></div><h3 id="creating-ansible-project-directory" tabindex="-1">Creating Ansible Project Directory <a class="header-anchor" href="#creating-ansible-project-directory" aria-label="Permalink to &quot;Creating Ansible Project Directory&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create project directory structure</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /ansible-project/{inventories,roles/system/tasks,playbooks,collections,templates}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create starting config files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/ansible-project/ansible.cfg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/inventories/hosts.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/roles/system/tasks/main.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/playbooks/system_setup.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/playbooks/kubernetes_setup.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/playbooks/kubernetes_seplay_remotetup.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ~/ansible-project/test_file</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Project structure visualised</span></span>
<span class="line"><span>ğŸ“ /ansible-project</span></span>
<span class="line"><span>|   âš™ï¸ ansible.cfg</span></span>
<span class="line"><span>|   ğŸ“„ test_file</span></span>
<span class="line"><span>â”œâ”€â”€ ğŸ“ inventories</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ğŸ“„ hosts.yml</span></span>
<span class="line"><span>â”œâ”€â”€ ğŸ“ roles</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ğŸ“ system</span></span>
<span class="line"><span>â”‚       â””â”€â”€ ğŸ“ tasks</span></span>
<span class="line"><span>â”œâ”€â”€ ğŸ“ playbooks</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ğŸ“„ play_remote.yml</span></span>
<span class="line"><span>â”œâ”€â”€ ğŸ“ collections</span></span>
<span class="line"><span>â””â”€â”€ ğŸ“ templates</span></span></code></pre></div><h3 id="initial-configuration" tabindex="-1">Initial Configuration <a class="header-anchor" href="#initial-configuration" aria-label="Permalink to &quot;Initial Configuration&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Config example: ansible.cfg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[defaults]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Path to inventory file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inventory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./inventories/hosts.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Roles search path</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">roles_path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./roles:/usr/share/ansible/roles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Collections search path (singular to avoid deprecation warning)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collections_path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./collections:/usr/share/ansible/collections</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Disable SSH host key checking (useful for local testing)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">host_key_checking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Human-readable YAML output</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stdout_callback</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Optional: Suppress deprecation warnings</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deprecation_warnings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Optional: parallelism</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forks</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Hosts example: inventories/hosts.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  hosts:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    gateway:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ansible_host:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        # Replace with your server IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ansible_user:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                # replace with your SSH username</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ansible_ssh_private_key_file:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/user/.ssh/key</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Path to SSH key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#  playbook example: playbooks/play_remote.yml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file_test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> production</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  hosts:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gateway</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  become:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  tasks:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Copy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file_test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remote</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      ansible.builtin.copy:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        src:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/ansible-project/file_test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # from control node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        dest:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./file_test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        # on target node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        mode:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0644&#39;</span></span></code></pre></div><h3 id="testing-configuration" tabindex="-1">Testing Configuration <a class="header-anchor" href="#testing-configuration" aria-label="Permalink to &quot;Testing Configuration&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check ansbile able to communicate with the target machines</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ping</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected: gateway | SUCCESS =&gt; {...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Testing sample playbook</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-playbook</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./playbooks/play_remote.yml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected: output with no errors  ok=2 changed =1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># you can also ssh on the target and see the new file created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Remote command execution</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ls -l /etc/dnsmasq.d&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected: should return list of files in that directory from target hosts</span></span></code></pre></div><p>Now we can start building more elaborate playbooks to automate system and service setup.</p><p>Next target, system package installations, updates and Kubernetes setup automation</p><h2 id="planned-creating-container-environment-ee" tabindex="-1">--PLANNED-- Creating Container Environment (EE) <a class="header-anchor" href="#planned-creating-container-environment-ee" aria-label="Permalink to &quot;--PLANNED-- Creating Container Environment (EE)&quot;">â€‹</a></h2><p>--PLANNED-- exploring at later stage containered setup for Ansible</p><p>Main components, ansible-builder, ansible-navigator, podman</p><p>...</p><p>...</p><p>...</p><p align="center"><img alt="pikube-logo" src="`+e+'" width="40%"></p>',27))])}const A=t(o,[["render",c]]);export{B as __pageData,A as default};
