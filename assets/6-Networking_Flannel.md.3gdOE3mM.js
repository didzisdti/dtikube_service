import{_ as i}from"./chunks/flannel.B58odNvk.js";import{_ as s,c as n,o as l,j as a,a0 as o,a as d,t as r}from"./chunks/framework.Do9hWntK.js";const m=JSON.parse('{"title":"Flannel","description":"Setup details","frontmatter":{"title":"Flannel","description":"Setup details"},"headers":[],"relativePath":"6-Networking/Flannel.md","filePath":"6-Networking/Flannel.md"}'),c={name:"6-Networking/Flannel.md"},h={id:"frontmatter-title",tabindex:"-1"};function p(t,e,k,g,u,f){return l(),n("div",null,[a("h1",h,[d(r(t.$frontmatter.title)+" ",1),e[0]||(e[0]=a("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }}"'},"​",-1))]),e[1]||(e[1]=o('<p align="center"><img alt="pikube-logo" src="'+i+`" width="25%"></p><p>Flannel is a lightweight CNI pluggin that is packaged together with K3s and and creates a layer 3 network overlay, by default as Virtual Extensible Local Area Network (VxLAN).</p><h2 id="config-options" tabindex="-1">Config Options <a class="header-anchor" href="#config-options" aria-label="Permalink to &quot;Config Options&quot;">​</a></h2><p>During K3s setup ther are several options to customise our CNI setup.</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>Flannel configuration must be identical across all master nodes of the cluster. No configration takes place on worker nodes. For Raspberry Pi running Ubuntu OS check compatibility and if an additional setup is reqired to use VxLAN <code>sudo apt install linux-modules-extra-raspi</code></p></div><table tabindex="0"><thead><tr><th>CLI Flag</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>--flannel-backend=</code></td><td><code>vxlan</code></td><td>Choice of Flannel networking backend. Available values: <code>vxlan</code>,<code>none</code>,<code>host-gw</code>,<code>wireguard-native</code>,<code>ipsec</code></td></tr><tr><td><code>--cluster-cidr=</code></td><td><code>10.42.0.0/16</code></td><td>IP address range from which Kubernetes assigns Pod IPs. Available values: Any valid CIDR</td></tr><tr><td><code>-service-cidr=</code></td><td><code>10.43.0.0/16</code></td><td>IP address range from which Kubernetes assigns Service IPs. Available values: Any valid CIDR</td></tr><tr><td><code>--flannel-iface=</code></td><td>auto detected</td><td>Network interface to which Flannel binds to. Available values: Any valid Linux network interface name</td></tr><tr><td><code>--flannel-external-ip</code></td><td>disabled</td><td>Uses the node’s external IP for inter-node traffic instead of the internal IP. Boolean flag type</td></tr><tr><td><code>--flannel-ipv6-masq</code></td><td>disabled</td><td>Enables IPv6 masquerading. Requires IPv6 cluster networking enabled. Boolean flag type</td></tr></tbody></table><h2 id="network-interfaces" tabindex="-1">Network Interfaces <a class="header-anchor" href="#network-interfaces" aria-label="Permalink to &quot;Network Interfaces&quot;">​</a></h2><p>During the setup a Flannel and bridge plugin is deployed. These plugins create network interfaces for pods and nodes: bridge (<code>veth</code> ,<code>cni0</code>), Flannel (<code>flannel.1</code>). <strong>Bridge plugin:</strong></p><ul><li><code>cni0</code>: A Linux network bridge that acts as a virtual switch, allowing communication between the pods on given node.</li><li><code>veth</code>: Creates a virtual ethernet pair where one end is plugged into the pod and other into cni0 bridge.</li></ul><p><strong>Flannel plugin:</strong></p><ul><li><code>flannel.1</code>: A VXLAN tunnel interface created by Flannel that encapsulates Pod traffic so it can be routed between nodes as if all Pods were on the same networ</li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Instances are created only if pods that require cross node communication are deployed on the specific node.</p></div><h2 id="ip-allocation" tabindex="-1">IP Allocation <a class="header-anchor" href="#ip-allocation" aria-label="Permalink to &quot;IP Allocation&quot;">​</a></h2><p>Flannel by default uses CIDR 10.42.0.0/16 and allocate subnets with 10.42.X.0/24 mask to each node, and Pods will get an IP addresses from these subnets. With this setup each node can have up to 254 Pods.</p><h2 id="package-flow" tabindex="-1">Package Flow <a class="header-anchor" href="#package-flow" aria-label="Permalink to &quot;Package Flow&quot;">​</a></h2><p>Simulating a package flow from node-1 pod-A to node 2 pod-B.</p><ul><li>Package leaves Node 1 pod-A through (<code>veth</code>) to bridge(<code>cni0</code>)</li><li>from bridge (<code>cni0</code>) to VxLAN (<code>flannel.1</code>)</li><li>from VXLAN physical switch</li><li>from physical switch to VxLAN(<code>flannel.1</code>) on Node 2</li><li>from VXLan (<code>flannel.1</code>) to bridge (<code>cni0</code>)</li><li>from brige (<code>cni0</code>) via <code>veth</code> to Pod-B</li></ul><h2 id="setup-check" tabindex="-1">Setup Check <a class="header-anchor" href="#setup-check" aria-label="Permalink to &quot;Setup Check&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Lookup interfaces created by Fannel CNI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cni0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flannel.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check Flannel config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/k3s/agent/etc/cni/net.d/10-flannel.conflist</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check node annotations</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;flannel&quot;</span></span></code></pre></div>`,19))])}const y=s(c,[["render",p]]);export{m as __pageData,y as default};
