<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K3s Cluster Configuration | Kube documentation</title>
    <meta name="description" content="Setup details">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/dtikube_service/assets/style._Za1h4vX.css" as="style">
    <link rel="preload stylesheet" href="/dtikube_service/vp-icons.css" as="style">
    
    <script type="module" src="/dtikube_service/assets/app.D-62u0MG.js"></script>
    <link rel="preload" href="/dtikube_service/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/framework.Do9hWntK.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/theme.CDL5D6to.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/katex.BbEIqZs1.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/dagre-6UL2VRFP.BNcrHzyv.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/cose-bilkent-S5V4N54A.B7t0_FMU.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/c4Diagram-YG6GDRKO.Dxnq3nfQ.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/flowDiagram-NV44I4VS.CBDdPS46.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/erDiagram-Q2GNP2WA.lLboMO5p.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/gitGraphDiagram-NY62KEGX.D1gadBpF.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/ganttDiagram-LVOFAZNH.Ch-JXzGP.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/infoDiagram-ER5ION4S.CQ7aEGEa.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/pieDiagram-ADFJNKIX.BwqWUqvm.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/quadrantDiagram-AYHSOK5B.C9yRNHRT.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/xychartDiagram-PRI3JC2R.Bn8uMkNx.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/requirementDiagram-UZGBJVZJ.BGeRA9oR.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/sequenceDiagram-WL72ISMW.CvjwUJVB.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/classDiagram-2ON5EDUG.L_OHk1YW.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/classDiagram-v2-WZHVMYZB.L_OHk1YW.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/stateDiagram-FKZM4ZOC.CQv1ctcQ.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/stateDiagram-v2-4FDKWEC3.BT3n2RXN.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/journeyDiagram-XKPGCS4Q.CYVv22Wz.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/timeline-definition-IT6M3QCI.DQBsV_VP.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/mindmap-definition-VGOIOE7T.BRGnOobU.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/kanban-definition-3W4ZIXB7.B6hZvNmC.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/sankeyDiagram-TZEHDZUN.BdwY0fUZ.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-S2PKOQOG.CUYmzyaa.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-QEK2KX5R.Cso4z_Oy.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/blockDiagram-VD42YOAC.Br8PMsyi.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/architectureDiagram-VXUJARFQ.CZ63NFww.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/diagram-PSM6KHXK.BbsBg5b4.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/K3s.D1n5sSLf.js">
    <link rel="modulepreload" href="/dtikube_service/assets/chunks/under-construction.CuWjDGLh.js">
    <link rel="modulepreload" href="/dtikube_service/assets/5-Kubernetes_k3s-Setup.md.CXlxTz8e.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/dtikube_service/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Kube documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/dtikube_service/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Project Overview</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Purpose.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Purpose</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Architecture-Design.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Architecture Setup</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/1-Project-Overview/Technology.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Technology Stack</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Access management</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/2-Access-Management/Account-Profiles.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Account Profiles</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Cluster setup</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/3-Cluster-Setup/Gateway-Config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Gateway Config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/3-Cluster-Setup/Node-Config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Node Config</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Automation</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/4-Automation/Ansible-node-setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Ansible Node Setup</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Kubernetes</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/5-Kubernetes/k3s-Setup.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>k3s Setup</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Networking</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/dtikube_service/6-Networking/k3s-Networking.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>k3s Networking</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _dtikube_service_5-Kubernetes_k3s-Setup" data-v-39a288b8><div><h1 id="frontmatter-title" tabindex="-1">K3s Cluster Configuration <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">‚Äã</a></h1><p align="center"><img alt="k3s" src="data:image/svg+xml,%3csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20128%20128&#39;%3e%3cpath%20d=&#39;M114.434%2011.875H13.547C6.074%2011.898.023%2017.949%200%2025.422v77.719c.023%207.472%206.074%2013.523%2013.547%2013.546h100.887c7.472-.023%2013.523-6.074%2013.546-13.546V25.42c-.023-7.472-6.074-13.523-13.546-13.546zM54.078%2088.094l-24.621%2014.308a6.592%206.592%200%2001-9.008-2.386%206.59%206.59%200%20012.387-9.008l24.621-14.309a6.587%206.587%200%20019.012%202.383%206.593%206.593%200%2001-2.39%209.012zm9.688-21.801h-.032a6.59%206.59%200%2001-6.558-6.617l.125-28.364a6.587%206.587%200%20016.586-6.562h.031a6.59%206.59%200%20016.559%206.617l-.125%2028.367a6.588%206.588%200%2001-6.586%206.559zm43.562%2033.703a6.585%206.585%200%2001-9%202.41L73.672%2088.172a6.589%206.589%200%20116.59-11.41l24.656%2014.234a6.586%206.586%200%20012.41%209zm0%200&#39;%20fill=&#39;%23ffc519&#39;/%3e%3c/svg%3e" width="25%"></p><h2 id="overview" tabindex="-1">üëÅÔ∏è Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;:eye: Overview&quot;">‚Äã</a></h2><p>K3d is a lightweight Kubernetes distribution. It is CNCF Certified project and it is designed for resources limited evnironments, an ideal choice for a mini data center.</p><p>K3s has two primary roles:</p><ul><li><strong><code>K3s-Server:</code></strong> Runs server components: control place, scheduler, cloud-controller, helm-controller, etcd, API server, kubelet and kube-proxy. Note that master nodes can also run worker node simultneously.</li><li><strong><code>K3s-Agent:</code></strong> Runs worker node components: kubelet and kube-proxy</li></ul><h2 id="cluster-architecture-configuration" tabindex="-1">Cluster Architecture configuration <a class="header-anchor" href="#cluster-architecture-configuration" aria-label="Permalink to &quot;Cluster Architecture configuration&quot;">‚Äã</a></h2><p>Cluster currently consists of 4 nodes and is planned to expand to meet the high availability setup in near future.</p><h3 id="master-nodes" tabindex="-1">Master Nodes <a class="header-anchor" href="#master-nodes" aria-label="Permalink to &quot;Master Nodes&quot;">‚Äã</a></h3><ul><li><strong><code>berry01</code></strong> (10.0.0.5) - Primary master node</li><li><strong><code>berry02</code></strong> (10.0.0.6) - Secondary master node</li></ul><h3 id="worker-nodes" tabindex="-1">Worker Nodes <a class="header-anchor" href="#worker-nodes" aria-label="Permalink to &quot;Worker Nodes&quot;">‚Äã</a></h3><ul><li><strong><code>berryw10</code></strong> (10.0.0.11) - Raspberry Pi 4B worker</li><li><strong><code>berryw11</code></strong> (10.0.0.12) - Raspberry Pi 5 worker</li></ul><h2 id="setup-pre-requisites" tabindex="-1">Setup Pre-requisites <a class="header-anchor" href="#setup-pre-requisites" aria-label="Permalink to &quot;Setup Pre-requisites&quot;">‚Äã</a></h2><p>Steps to action on all nodes before K3s installation to ensure smooth start.</p><h3 id="enable-cgroup" tabindex="-1">Enable cgroup <a class="header-anchor" href="#enable-cgroup" aria-label="Permalink to &quot;Enable cgroup&quot;">‚Äã</a></h3><p>For Raspberry Pi by default this is not enabled and Kubernetes would not start successfully. Target file: <code>/boot/firmware/cmdline.txt</code> or <code>/boot/firmware/current/cmdline.txt</code> check the system before executing</p><p><strong>Checks:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check existing setup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cgroup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /sys/fs/cgroup/cgroup.controllers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory</span></span></code></pre></div><p><strong>Update:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add to the existing kernel parameters in the same line:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;s/$/ cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /boot/firmware/current/cmdline.txt</span></span></code></pre></div><h3 id="enable-bridge-networking" tabindex="-1">Enable Bridge Networking <a class="header-anchor" href="#enable-bridge-networking" aria-label="Permalink to &quot;Enable Bridge Networking&quot;">‚Äã</a></h3><p>Bridge networking lets pods communicate with each other and the host via a virtual network. It‚Äôs needed for consistent pod networking and isolation in Kubernetes.</p><p><strong>Checks:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check if netfilter settings are correct</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Expected:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check if iptables are enabled to process bridged traffic by loading the required kernel module:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modules-load.d/k8s.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Expected: br_netfilter</span></span></code></pre></div><p><strong>Update:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable iptables kernel module</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;br_netfilter&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/modules-load.d/k8s.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># enable netfilter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><h3 id="disable-swap" tabindex="-1">Disable Swap <a class="header-anchor" href="#disable-swap" aria-label="Permalink to &quot;Disable Swap&quot;">‚Äã</a></h3><p>Ruuning Kubernetes with acitve swap is not advised, it can affect pod stability as kubelet does not ‚Äúsee‚Äù memory in swap. Swap can also adversly affect the lifespan of your MicroSD cards.</p><p><strong>Checks:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check if swap is being allocated and used</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">free</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">htop</span></span></code></pre></div><p><strong>Update:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Temporary disable swap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swapoff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For persistant removal of swap comment outw with &#39;#&#39; swap entries in file below  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/fstab</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>For changes to apply, you must reboot the target host.</p></div><h2 id="high-availability-configuration" tabindex="-1">High Availability Configuration <a class="header-anchor" href="#high-availability-configuration" aria-label="Permalink to &quot;High Availability Configuration&quot;">‚Äã</a></h2><p>For Cluster that has more than 1 master the setup will require a load balancing element. HAProxy will be used to load balanace using our central gateway node.</p><h3 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check HAProxy is already deployed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install the required packge</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span></code></pre></div><h3 id="configuration-etc-haproxy-haproxy-cfg" tabindex="-1">Configuration <code>/etc/haproxy/haproxy.cfg</code> <a class="header-anchor" href="#configuration-etc-haproxy-haproxy-cfg" aria-label="Permalink to &quot;Configuration `/etc/haproxy/haproxy.cfg`&quot;">‚Äã</a></h3><p>Once installed we have default values already provided, most of which we will use.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Defaults post installation</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">global</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Loggs to debug HAProxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    local0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    local1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> notice</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Security setting</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        chroot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/haproxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Enables external tools to query HAProxy for status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> socket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/haproxy/admin.sock</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 660</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        stats</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 30s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Security and process management</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        daemon</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Default SSL material locations</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ca-base</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssl/certs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        crt-base</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssl/private</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # See: https://ssl-config.mozilla.org/#server=haproxy&amp;server-version=2.0.3&amp;config=intermediate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ssl-default-bind-ciphers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ssl-default-bind-ciphersuites</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ssl-default-bind-options</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ssl-min-ver</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TLSv1.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no-tls-tickets</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defaults</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Logging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     global</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Connection more with options</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  httplog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  dontlognull</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Timeout ettings (in seconds)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  50000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  50000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Error page config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 400</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/400.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/403.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 408</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/408.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/500.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 502</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/502.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 503</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/503.http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        errorfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 504</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/errors/504.http</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Additionally added config</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Frontend API</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k3s_api</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Listen configuration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:6443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcplog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Route to backend</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    default_backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k3s_backend</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Backend Control Plane</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k3s_backend</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Connection configuration</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp-check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    balance</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> roundrobin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Master nodes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> berry01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.5:6443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> berry02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.0.0.6:6443</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check</span></span></code></pre></div><h3 id="check-and-restart" tabindex="-1">Check and Restart <a class="header-anchor" href="#check-and-restart" aria-label="Permalink to &quot;Check and Restart&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Validate config syntax</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/haproxy/haproxy.cfg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Apply change and ensure startup after servere restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> haproxy</span></span></code></pre></div><h2 id="master-creation" tabindex="-1">Master Creation <a class="header-anchor" href="#master-creation" aria-label="Permalink to &quot;Master Creation&quot;">‚Äã</a></h2><p>Cluster has primary master to which all other nodes (master and worker) will be joining.</p><h2 id="worker-creation" tabindex="-1">Worker Creation <a class="header-anchor" href="#worker-creation" aria-label="Permalink to &quot;Worker Creation&quot;">‚Äã</a></h2><p>...</p><p>...</p><p align="center"><img alt="pikube-logo" src="/dtikube_service/assets/under-construction.R_-H1EPk.svg" width="40%"></p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/dtikube_service/4-Automation/Ansible-node-setup.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Ansible Node Setup</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/dtikube_service/6-Networking/k3s-Networking.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>k3s Networking</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"1-project-overview_architecture-design.md\":\"CQ0RO56J\",\"1-project-overview_purpose.md\":\"ChTBXNes\",\"1-project-overview_technology.md\":\"Bm8OKZ46\",\"2-access-management_account-profiles.md\":\"Cl9woTDs\",\"2-access-management_setup-and-hardening.md\":\"C5CRLPlw\",\"3-cluster-setup_gateway-config.md\":\"BaI69eSN\",\"3-cluster-setup_node-config.md\":\"DuMkt3oG\",\"4-automation_ansible-node-setup.md\":\"aplv778r\",\"5-kubernetes_k3s-setup.md\":\"CXlxTz8e\",\"6-networking_k3s-networking.md\":\"CjMNEMgp\",\"index.md\":\"K6D8Ii3Q\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Kube documentation\",\"description\":\"Documentation for the Baremetal kubernetes setup\",\"base\":\"/dtikube_service/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"}],\"sidebar\":[{\"text\":\"Project Overview\",\"collapsed\":true,\"items\":[{\"text\":\"Purpose\",\"link\":\"/1-Project-Overview/Purpose\"},{\"text\":\"Architecture Setup\",\"link\":\"/1-Project-Overview/Architecture-Design\"},{\"text\":\"Technology Stack\",\"link\":\"/1-Project-Overview/Technology\"}]},{\"text\":\"Access management\",\"collapsed\":true,\"items\":[{\"text\":\"Account Profiles\",\"link\":\"/2-Access-Management/Account-Profiles\"}]},{\"text\":\"Cluster setup\",\"collapsed\":true,\"items\":[{\"text\":\"Gateway Config\",\"link\":\"/3-Cluster-Setup/Gateway-Config\"},{\"text\":\"Node Config\",\"link\":\"/3-Cluster-Setup/Node-Config\"}]},{\"text\":\"Automation\",\"collapsed\":false,\"items\":[{\"text\":\"Ansible Node Setup\",\"link\":\"/4-Automation/Ansible-node-setup\"}]},{\"text\":\"Kubernetes\",\"collapsed\":true,\"items\":[{\"text\":\"k3s Setup\",\"link\":\"/5-Kubernetes/k3s-Setup\"}]},{\"text\":\"Networking\",\"collapsed\":true,\"items\":[{\"text\":\"k3s Networking\",\"link\":\"/6-Networking/k3s-Networking\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>